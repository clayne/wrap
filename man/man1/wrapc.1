.\"
.\"     wrapc -- comment reformatter
.\"     wrapc.1: manual page
.\"
.\"     Copyright (C) 1996-2016  Paul J. Lucas
.\"
.\"     This program is free software; you can redistribute it and/or modify
.\"     it under the terms of the GNU General Public License as published by
.\"     the Free Software Foundation; either version 2 of the Licence, or
.\"     (at your option) any later version.
.\"
.\"     This program is distributed in the hope that it will be useful,
.\"     but WITHOUT ANY WARRANTY; without even the implied warranty of
.\"     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\"     GNU General Public License for more details.
.\"
.\"     You should have received a copy of the GNU General Public License
.\"     along with this program.  If not, see <http://www.gnu.org/licenses/>.
.\"
.\" ---------------------------------------------------------------------------
.\" define code-start macro
.de cS
.sp
.nf
.RS 5
.ft CW
..
.\" define code-end macro
.de cE
.ft 1
.RE
.fi
.if !'\\$1'0' .sp
..
.\" ---------------------------------------------------------------------------
.TH \f3wrapc\fP 1 "July 31, 2016" "PJL TOOLS"
.SH NAME
wrapc \- comment reformatter
.SH SYNOPSIS
.B wrapc
.BI [ options ]
.SH DESCRIPTION
.B wrapc
is a filter for reformatting source code comments
(or quoted e-mail)
by wrapping and filling lines to a given
.IR line-width ,
the default for which is 80 characters.
.P
The
.I characters
that are recognized
by default
as comment delimiters
and the non-exhaustive set of languages that use them
are the union of:
.P
.PD 0
.RS 5
.IP "\f(CW#\fP" 5
AWK, CMake, Julia, Make, Perl, Python, R, Ruby, Shell
.IP "\f(CW#=\fP"
Julia
.IP "\f(CW#|\fP"
Lisp, Racket, Scheme
.IP "\f(CW/*\fP"
C, Objective C, C++, C#, D, Go, Java, Rust, Scala, Swift
.IP "\f(CW/+\fP"
D
.IP "\f(CW--\fP"
Ada, AppleScript, Eiffel, Haskell, Lua
.IP "\f(CW(:\fP"
XQuery
.IP "\f(CW(*\fP"
AppleScript, Delphi, ML, Modula-[23], Oberon, OCaml, Pascal
.IP "\f(CW{-\fP"
Haskell
.IP "\f(CW{ }\fP"
Pascal
.IP "\f(CW!\fP"
Fortran
.IP "\f(CW%\fP"
Erlang, PostScript, Prolog, TeX
.IP "\f(CW;\fP"
Assembly, Clojure, Lisp, Scheme
.IP "\f(CW<#\fP"
PowerShell
.IP "\f(CW>\fP"
Quoted e-mail
.IP "\f(CW*>\fP"
COBOL 2002
.RE
.PD
.P
Comments are formatted subject to the following:
.IP \[bu] 2
Comment characters are treated as such
only when they are the first
or last
non-whitespace characters on a line.
.IP \[bu]
Leading whitespace and comment delimiter characters
as well as trailing comment delimiter characters
of the first line
are used as the ``prototype'' for all lines.
.IP \[bu]
For each line,
all leading whitespace and comment delimiter characters
as well as all trailing comment delimiter characters
are stripped
before being passed to
.BR wrap (1)
for reformatting.
.IP \[bu]
After reformatting,
the prototype characters
of the first comment line
are prepended to the start
and appended to the end
of each line.
.SS Trailing Source Code Passthrough
If the first non-whitespace character of a subsequent line
is
.I not
a comment delimiter character,
it signals the end of the comment
and all remaining lines
are passed through unaltered.
For example, given:
.cS
# We want to resolve the symbolic link of ONLY src_path
# and not ALL the symbolic links in the entire path,
# hence we can't use realpath().
new_src_path = os.readlink( src_path )
.cE
.B wrapc
will reformat the first three lines,
but will not alter the fourth and remaining lines.
.SS Block Comments
Block comments,
for example:
.cS
/*
 * Reads the output of wrap(1) and prepends the leading
 * whitespace and comment characters back to each line.
 */
static void read_wrap( void ) {
.cE
are treated specially in that:
.IP \[bu] 2
The first line is not altered
if it only contains any number of non-alphabetic characters.
.IP \[bu]
Leading whitespace and comment delimiter characters of the
.I second
line are used as the ``prototype'' for all remaining comment lines.
.IP \[bu]
The last comment line,
the one only containing any number of non-alphabetic characters,
and any subsequent lines are also not altered.
.SS Boxed Comments
Boxed comments, for example:
.cS
/********************************************************/
/* Lorem ipsum dolor sit amet, ligula suspendisse nulla */
/* pretium, rhoncus tempor fermentum, enim integer ad   */
/* vestibulum volutpat.                                 */
/********************************************************/
.cE
where every line is ended by a comment delimiter
and the delimiters are aligned to form a ``box,''
are treated specially in that:
.IP \[bu] 2
If comprised of only comment delimiter characters,
the first and last lines are either lengthened or shortened to
.I line-width
(see the
.B \-w
option).
.IP \[bu]
The trailing comment delimiter characters on every line
are all vertically aligned at
.IR line-width .
.SS Non-Comments
If the first non-whitespace character
of the first line
is
.I not
a comment delimiter character,
then whatever leading whitespace alone, if any,
is used as the prototype for all lines.
.SS Markdown Text
If the
.B \-u
option is specified,
exceptions are made
in order to pretty-print Markdown text
within comments
(see
.B MARKDOWN FORMATTING
in
.BR wrap (1)).
.SH OPTIONS
An option argument
.I f
means
.IR file ,
.I n
means
.IR "unsigned integer" ,
and
.I s
means
.IR string .
.TP
.BI \-a " s"
Specifies the alias name
.I s
from the configuration file to be used.
This overrides any alias
from a matched pattern
via either the
.B \-f
or
.B \-F
options.
.TP
.BI \-b " s"
Specifies the set of ``block'' characters
.I s
that,
when the first character on a line,
delimits a paragraph.
.TP
.BI \-c " f"
Specifies the configuration file
.I f
to read
(default is
.BR ~/.wraprc )
if warranted.
.TP
.B \-C
Suppresses reading of any configuration file,
even one explicitly specified via
.BR \-c .
.TP
.BI \-D " s"
Specifies the set of comment delimiter characters
.I s
overriding the default.
.TP
.B \-e
Treats whitespace after an end-of-sentence character as a paragraph delimiter.
.TP
.BI \-f " f"
Reads from file
.I f
(default is standard input).
.TP
.BI \-F " f"
Sets the file-name to
.I f
as if it were being read from
but still reads from standard input.
(This allows the file-name to be matched against a pattern
in a configuration file to use an alias
while still allowing
.B wrapc
to be used as part of a shell pipeline.)
.TP
.BI \-l " s"
Specifies the line-endings to use
.IR s ,
one of
\f(CW-\fP,
\f(CWi\fP,
or
\f(CWinput\fP
(whatever the input uses, the default);
\f(CWcrlf\fP,
\f(CWd\fP,
\f(CWdos\fP,
\f(CWw\fP,
or
\f(CWwindows\fP
(DOS/Windows: CR+LF);
or
\f(CWlf\fP,
\f(CWu\fP,
or
\f(CWunix\fP
(Unix: LF);
all case-insensitive.
.TP
.BI \-o " f"
Writes to file
.I f
(default is standard output).
.TP
.BI \-p " s"
Treats the given characters in
.I s
as paragraph delimiters.
.TP
.BI \-s " n"
Sets
.I tab-spaces
(the number of spaces a tab character should be considered the same as)
to
.I n
characters
(default is 8).
.TP
.B \-T
Treats the first line of every paragraph as a title
and puts it on a line by itself.
.TP
.B \-u
Format Markdown text.
.TP
.B \-v
Prints the version number to
.I stderr
and exits.
.TP
.BI \-w " n"
Sets
.I line-width
to
.I n
characters
(default is 80).
.SH EXIT STATUS
.PD 0
.IP 0
Success.
.IP 64
Command-line usage error.
.IP 66
Open file error.
.IP 71
System error.
.IP 73
Create file error.
.IP 74
I/O error.
.IP 78
Error in configuration file.
.PD
.SH ENVIRONMENT
.TP
.B HOME
The user's home directory:
used to locate the default configuration file.
If unset,
the home directory is obtained from the password database entry
for the effective user.
If that fails,
no default configuration file is read.
.SH FILES
.TP
.B ~/.wraprc
The default configuration file.
A configuration file,
even one explicitly specified via
.BR \-c ,
is neither actually checked for existence nor read
unless one of the
.BR \-a ,
.BR \-f ,
or
.B \-F
options
is specified
since it doesn't affect the result.
.SH EXAMPLE
While in
.BR vi ,
wrap the comment from the current line to the end of the paragraph:
.cS
!}wrapc -F'%'
.cE
The \f(CW%\fP argument to the
.B \-F
option is expaned by
.B vi
to be the file's path name.
This enables
.B wrapc
to use any applicable alias
from a configuration file, if any.
.P
To lessen typing,
the above can be mapped to a key sequence in
.BR vi 's
\f(CW.exrc\fP
file:
.cS
map `c !}wrapc -F'%'\f3^M\fP
.cE 0
.SH AUTHOR
Paul J. Lucas
.RI < paul@lucasmail.org >
.SH SEE ALSO
.BR par (1),
.BR vi (1),
.BR wrap (1),
.BR sysexits (3),
.BR wraprc (5)
.\" vim:set et sw=2 ts=2:
